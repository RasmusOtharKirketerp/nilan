name: Release Version Check

on:
  workflow_dispatch:
  push:
    tags:
      - "v*"
      - "V*"
  release:
    types: [published, prereleased, released, edited]

permissions:
  contents: read

jobs:
  verify-version:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Compare tag with manifest version
        run: |
          TAG="${GITHUB_REF_NAME#v}"
          MANIFEST_VERSION=$(python - <<'PY'
import json
print(json.load(open('custom_components/nilan_nabto/manifest.json'))['version'])
PY
)
          echo "Tag version: $TAG"
          echo "Manifest version: $MANIFEST_VERSION"
          test "$TAG" = "$MANIFEST_VERSION"
